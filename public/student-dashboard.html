<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard - EduLearn</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="/assets/edulearn.css" rel="stylesheet">
  <link href="/assets/style.css" rel="stylesheet">
  <script defer src="/assets/app.js"></script>
  <script defer src="/assets/main.js"></script>
  <script defer src="/assets/student-dashboard.js"></script>
  <style>
    .dashboard-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      margin-top: 30px;
    }
    
    .profile-card {
      background: white;
      border-radius: 8px;
      padding: 0;
      box-shadow: 0 2px 15px rgba(0,0,0,0.05);
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .profile-header {
      background: var(--secondary);
      color: white;
      padding: 30px 20px;
      text-align: center;
      position: relative;
    }
    
    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: white;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 50px;
      color: var(--secondary);
    }
    
    .profile-name {
      font-size: 22px;
      margin: 0 0 5px;
    }
    
    .profile-email {
      font-size: 14px;
      opacity: 0.8;
      margin: 0;
    }
    
    .profile-body {
      padding: 20px;
    }
    
    .progress-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .progress-item {
      margin-bottom: 15px;
    }
    
    .progress-item h4 {
      margin: 0 0 5px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
    }
    
    .progress-bar {
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary);
    }
    
    .student-card {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .student-card h3 {
      margin-top: 0;
      color: var(--secondary);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    .enrolled-courses {
      margin-top: 30px;
    }
    
    .course-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }
    
    .course-stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .course-stat {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 15px rgba(0,0,0,0.05);
    }
    
    .course-stat i {
      font-size: 30px;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    .course-stat h3 {
      font-size: 24px;
      margin: 0 0 5px;
    }
    
    .course-stat p {
      margin: 0;
      color: var(--text-muted);
    }
    
    .timeline {
      margin-top: 20px;
      padding-left: 30px;
      border-left: 2px solid var(--border-light);
    }
    
    .timeline-item {
      position: relative;
      padding-bottom: 25px;
    }
    
    .timeline-item:last-child {
      padding-bottom: 0;
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -38px;
      top: 0;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--primary);
      border: 3px solid white;
    }
    
    .timeline-date {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 5px;
    }
    
    .timeline-content h4 {
      margin: 0 0 5px;
    }
    
    .timeline-content p {
      margin: 0;
      color: var(--text-muted);
    }
    
    @media (max-width: 992px) {
      .dashboard-container {
        grid-template-columns: 1fr;
      }
      
      .course-stats-row {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="main-header">
    <div class="top-bar">
      <div class="top-bar-container">
        <div class="contact-info">
          <span><i class="far fa-envelope"></i> support@edulearn.com</span>
          <span><i class="fas fa-phone"></i> +1234 567 890</span>
        </div>
        <div class="social-links">
          <a href="#"><i class="fas fa-bell"></i></a>
          <a href="#"><i class="fas fa-envelope"></i></a>
        </div>
      </div>
    </div>
    <div class="nav-container">
      <a href="/" class="logo">
        <img src="/assets/logo.png" alt="EduLearn" id="placeholder-logo">
        EduLearn <span style="font-size: 16px; opacity: 0.8;">Student</span>
      </a>
      <nav class="main-nav">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/student/dashboard" class="active">Dashboard</a></li>
          <li><a href="/courses">Browse Courses</a></li>
          <li><a href="/student/calendar">Calendar</a></li>
        </ul>
      </nav>
      <div class="header-buttons">
        <button onclick="logout()" class="register-btn">Logout</button>
      </div>
    </div>
  </header>

  <!-- Breadcrumbs -->
  <div class="breadcrumbs">
    <div class="breadcrumbs-container">
      <h2 class="page-title">Student Dashboard</h2>
      <ul class="breadcrumbs-list">
        <li class="breadcrumbs-item"><a href="/">Home</a></li>
        <li class="breadcrumbs-item active">Dashboard</li>
      </ul>
    </div>
  </div>

  <main class="container">
    <div class="course-stats-row">
      <div class="course-stat">
        <i class="fas fa-book"></i>
        <h3 id="enrolled-count">--</h3>
        <p>Enrolled Courses</p>
      </div>
      <div class="course-stat">
        <i class="fas fa-graduation-cap"></i>
        <h3 id="completed-count">--</h3>
        <p>Completed Courses</p>
      </div>
      <div class="course-stat">
        <i class="fas fa-certificate"></i>
        <h3 id="certificate-count">--</h3>
        <p>Certificates</p>
      </div>
      <div class="course-stat">
        <i class="fas fa-clock"></i>
        <h3 id="hours-count">--</h3>
        <p>Learning Hours</p>
      </div>
    </div>
    
    <div class="dashboard-container">
      <div class="sidebar-content">
        <div class="profile-card">
          <div class="profile-header">
            <div class="profile-avatar">
              <i class="fas fa-user"></i>
            </div>
            <h3 class="profile-name" id="student-name">Student Name</h3>
            <p class="profile-email" id="student-email">student@example.com</p>
          </div>
          <div class="profile-body">
            <h4>My Course Progress</h4>
            <ul class="progress-list" id="course-progress-list">
              <li class="progress-item">
                <h4>Web Development <span>75%</span></h4>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 75%"></div>
                </div>
              </li>
              <li class="progress-item">
                <h4>JavaScript Fundamentals <span>45%</span></h4>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 45%"></div>
                </div>
              </li>
              <li class="progress-item">
                <h4>UX/UI Design <span>90%</span></h4>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 90%"></div>
                </div>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="student-card">
          <h3><i class="fas fa-calendar-alt"></i> Upcoming Activities</h3>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-date">Tomorrow, 10:00 AM</div>
              <div class="timeline-content">
                <h4>JavaScript Quiz</h4>
                <p>JavaScript Fundamentals - Module 3</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-date">Sep 25, 02:00 PM</div>
              <div class="timeline-content">
                <h4>Assignment Due</h4>
                <p>Web Development - Final Project</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-date">Sep 28, 11:00 AM</div>
              <div class="timeline-content">
                <h4>Live Session</h4>
                <p>UX/UI Design - User Testing</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="main-content">
        <div class="student-card">
          <h3><i class="fas fa-book"></i> My Enrolled Courses</h3>
          <div id="enrolled-courses" class="course-cards">
            <!-- Courses will be loaded here -->
            <p class="text-center">Loading enrolled courses...</p>
          </div>
        </div>
        
        <div class="student-card">
          <h3><i class="fas fa-chart-line"></i> My Activity</h3>
          <div id="activity-chart">
            <p class="text-center">Loading activity data...</p>
          </div>
        </div>
        
        <div class="student-card">
          <h3><i class="fas fa-star"></i> Recommended Courses</h3>
          <div id="recommended-courses" class="course-cards">
            <!-- Recommended courses will be loaded here -->
            <p class="text-center">Loading recommendations...</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col">
          <h3>Student Portal</h3>
          <p>EduLearn Student Portal provides easy access to your courses, assignments, quizzes, and academic resources.</p>
        </div>
        <div class="footer-col">
          <h3>Quick Links</h3>
          <ul class="footer-links">
            <li><a href="/">Home</a></li>
            <li><a href="/student/dashboard">Dashboard</a></li>
            <li><a href="/courses">Browse Courses</a></li>
            <li><a href="/student/calendar">Calendar</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>Support</h3>
          <ul class="footer-links">
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Support</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2023 EduLearn Student Portal. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        // Get current user
        const response = await api('/api/me', { method: 'GET' });
        
        if (response.user) {
          document.getElementById('student-name').textContent = response.user.name;
          document.getElementById('student-email').textContent = response.user.email;
        } else {
          location.href = '/login';
          return;
        }
        
        // Load student's enrolled courses
        const coursesResponse = await api('/api/my-courses', { method: 'GET' });
        
        if (coursesResponse && coursesResponse.courses) {
          const enrolledCourses = coursesResponse.courses;
          
          // Update stats
          document.getElementById('enrolled-count').textContent = enrolledCourses.length;
          document.getElementById('completed-count').textContent = '0'; // TODO: Calculate from progress
          document.getElementById('certificate-count').textContent = '0'; // TODO: Implement certificates
          document.getElementById('hours-count').textContent = enrolledCourses.reduce((total, course) => total + (Number(course.projected_hours) || 0), 0);
          
          // Update course progress list
          const progressList = document.getElementById('course-progress-list');
          if (enrolledCourses.length > 0) {
            progressList.innerHTML = enrolledCourses.slice(0, 3).map(course => `
              <li class="progress-item">
                <h4>${course.title} <span>0%</span></h4>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 0%"></div>
                </div>
              </li>
            `).join('');
          } else {
            progressList.innerHTML = `
              <li class="progress-item">
                <h4>No courses enrolled</h4>
                <p>Browse and enroll in courses to start learning!</p>
              </li>
            `;
          }
          
          // Load enrolled courses section
          const enrolledCoursesContainer = document.getElementById('enrolled-courses');
          if (enrolledCourses.length > 0) {
            enrolledCoursesContainer.innerHTML = enrolledCourses.map(course => `
              <div class="course-card">
                <div class="course-image">
                  <img src="${course.thumbnail_url || 'https://via.placeholder.com/300x200'}" alt="${course.title}">
                  <span class="course-price">Enrolled</span>
                </div>
                <div class="course-content">
                  <span class="course-category">By ${course.teacher_name}</span>
                  <h3 class="course-title">${course.title}</h3>
                  <p>${course.description ? course.description.substring(0, 100) + '...' : 'No description available'}</p>
                </div>
                <div class="course-stats">
                  <span><i class="fas fa-book"></i> 0% complete</span>
                  <a href="/student/course?id=${course.id}" class="action-btn btn-view">Continue</a>
                </div>
              </div>
            `).join('');
          } else {
            enrolledCoursesContainer.innerHTML = `
              <div class="text-center" style="grid-column: 1 / -1;">
                <h3>No courses enrolled yet</h3>
                <p>Browse our course catalog and enroll in courses that interest you!</p>
                <a href="/courses" class="btn-primary">Browse Courses</a>
              </div>
            `;
          }
          
          // Load recommended courses from public courses
          const publicCoursesResponse = await api('/api/public-courses', { method: 'GET' });
          const recommendedContainer = document.getElementById('recommended-courses');
          
          if (publicCoursesResponse && publicCoursesResponse.courses) {
            // Filter out already enrolled courses
            const enrolledIds = enrolledCourses.map(c => c.id);
            const recommendedCourses = publicCoursesResponse.courses
              .filter(course => !enrolledIds.includes(course.id))
              .slice(0, 2);
            
            if (recommendedCourses.length > 0) {
              recommendedContainer.innerHTML = recommendedCourses.map(course => `
                <div class="course-card">
                  <div class="course-image">
                    <img src="${course.thumbnail_url || 'https://via.placeholder.com/300x200'}" alt="${course.title}">
                    <span class="course-price">${course.is_free ? 'Free' : 'PKR ' + course.price}</span>
                  </div>
                  <div class="course-content">
                    <span class="course-category">By ${course.teacher_name}</span>
                    <h3 class="course-title">${course.title}</h3>
                    <p>${course.description ? course.description.substring(0, 100) + '...' : 'No description available'}</p>
                  </div>
                  <div class="course-stats">
                    <span><i class="fas fa-user"></i> ${course.lecture_count || 0} lectures</span>
                    <button class="action-btn btn-view" onclick="enrollInCourse(${course.id})">Enroll</button>
                  </div>
                </div>
              `).join('');
            } else {
              recommendedContainer.innerHTML = '<p class="text-center">No new courses to recommend.</p>';
            }
          }
          
          // Mock activity chart
          document.getElementById('activity-chart').innerHTML = `
            <div style="height: 200px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
              <p>Activity tracking coming soon!</p>
            </div>
          `;
        }
        
      } catch (error) {
        console.error('Failed to load student dashboard:', error);
      }
      
      // Check if logo exists
      const logo = document.getElementById('placeholder-logo');
      logo.onerror = function() {
        logo.style.display = 'none';
      };
    });
    
    async function enrollInCourse(courseId) {
      try {
        await api('/api/enroll', {
          method: 'POST',
          body: JSON.stringify({ course_id: courseId })
        });
        
        alert('Successfully enrolled in course!');
        location.reload(); // Refresh to show updated data
      } catch (error) {
        alert('Failed to enroll in course: ' + error.message);
      }
    }
  </script>
</body>
</html>
